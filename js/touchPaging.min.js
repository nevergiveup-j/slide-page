/** 
 * @Description: touchPaging 
 * @Author: wangjun 
 * @Update: 2015-03-30 16:03 
 * @Github: https://github.com/nevergiveup-j/touchPaging 
 */ 
!function(a){"function"==typeof define&&define.amd?define(["Zepto"],a):a(Zepto)}(function(a){"use strict";function b(b,c){this.$page=a(".m-page"),e=a.extend(!0,{},e,c||{}),e.pageNumber=this.$page.length,this.init()}var c=navigator.userAgent,d={UC:RegExp("Android").test(c)&&RegExp("UC").test(c)?!0:!1,weixin:RegExp("MicroMessenger").test(c)?!0:!1,iPhone:RegExp("iPhone").test(c)||RegExp("iPod").test(c)||RegExp("iPad").test(c)?!0:!1,android:RegExp("Android").test(c)?!0:!1,isPC:function(){for(var a=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),b=!0,d=0;d<a.length;d++)if(c.indexOf(a[d])>0){b=!1;break}return b},elementStyle:document.createElement("div").style,vendor:function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,e=b.length;e>c;c++)if(a=b[c]+"ransform",a in d.elementStyle)return b[c].substr(0,b[c].length-1);return!1},prefixStyle:function(a){return d.vendor()===!1?!1:""===d.vendor()?a:d.vendor()+a.charAt(0).toUpperCase()+a.substr(1)},hasPerspective:function(){var a=d.prefixStyle("perspective")in d.elementStyle;return a&&"webkitPerspective"in d.elementStyle&&d.injectStyles("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=9===b.offsetLeft&&3===b.offsetHeight}),!!a},translateZ:function(){return d.hasPerspective?" translateZ(0)":""},injectStyles:function(a,b,c,d){var e,f,g,h,i=document.createElement("div"),j=document.body,k=j||document.createElement("body"),l="modernizr";if(parseInt(c,10))for(;c--;)g=document.createElement("div"),g.id=d?d[c]:l+(c+1),i.appendChild(g);return e=["&#173;",'<style id="s',l,'">',a,"</style>"].join(""),i.id=l,(j?i:k).innerHTML+=e,k.appendChild(i),j||(k.style.background="",k.style.overflow="hidden",h=docElement.style.overflow,docElement.style.overflow="hidden",docElement.appendChild(k)),f=b(i,a),j?i.parentNode.removeChild(i):(k.parentNode.removeChild(k),docElement.style.overflow=h),!!f}},e={pageNow:0,pageNext:null,touchStartY:0,moveStart:!0,touchDeltaY:0,switchEffect:"default",movePosition:null,returnFirst:!1,returnLast:!1};return b.prototype.init=function(){document.body.style.userSelect="none",document.body.style.mozUserSelect="none",document.body.style.webkitUserSelect="none",a(document.body).addClass(d.isPC()?"pc":"mobile"),d.android&&a(document.body).addClass("android"),d.iPhone&&a(document.body).addClass("iphone"),a(document.body).addClass(d.hasPerspective()?"yes-3d":"no-3d"),this.$page.height(a(window).height()),a(".page-content").height(a(window).height()),a("body").trigger("test"),this.lazyIMGStart(),this.addEvent(),this.triggerFunction()},b.prototype.addEvent=function(){var a=this;a.$page.on("touchstart mousedown",function(b){a.touchStart(b)}),a.$page.on("touchmove mousemove",function(b){a.touchMove(b)}),a.$page.on("touchend mouseup",function(b){a.touchEnd(b)})},b.prototype.removeEvent=function(){this.$page.off("touchstart mousedown"),this.$page.off("touchmove mousemove"),this.$page.off("touchend mouseup")},b.prototype.touchStart=function(b){var c=0;e.moveStart&&(c="touchstart"==b.type?b.touches[0].pageY:b.pageY||b.y,e.touchStartY=c,a(window).trigger("start",[e]))},b.prototype.touchMove=function(b){var c;if(e.moveStart){c="touchmove"==b.type?b.touches[0].pageY:b.pageY||b.y;var d=this.direction(b,c);this.translate(d),a(window).trigger("move",[e])}},b.prototype.direction=function(b,c){function f(b,c){var f,g,h=d.translateZ();c.removeClass("active"),a(b[0]).removeClass("fn-hide"),a(b[1]).removeClass("fn-hide").addClass("active"),"up"==e.movePosition?(f=parseInt(a(window).scrollTop()),g=f>0?a(window).height()+f:a(window).height()):g=-Math.max(a(window).height(),a(b[1]).height()),b[1].style[d.prefixStyle("transform")]="translate(0,"+g+"px)"+h,a(b[0]).attr("data-translate",0),a(b[1]).attr("data-translate",g)}var g,h,i,j=this.$page.eq(e.pageNow);if("undefined"!=c&&(e.touchDeltaY=c-e.touchStartY),e.movePosition=c-e.touchStartY>0?"down":"up",e.returnFirst||!(e.pageNow>=e.pageNumber-1)||"up"!=e.movePosition){if("down"==e.movePosition&&a(".fixed-arrow").show(),e.touchDeltaY<=0)e.pageNext=0==j.next(".m-page").length?0:e.pageNow+1;else if(0==j.prev(".m-page").length){if(!e.returnLast)return;e.pageNext=e.pageNumber-1}else e.pageNext=e.pageNow-1;return g=this.$page.eq(e.pageNow)[0],h=this.$page.eq(e.pageNext)[0],i=[g,h],f(i,this.$page),i}},b.prototype.translate=function(b){if(b){var c,f,g=d.translateZ(),h=e.touchDeltaY,i=1;"scale"==e.switchEffect&&(i=1-Math.abs(.2*h/a(window).height())),a(b[0]).attr("data-translate")&&(f=h+parseInt(a(b[0]).attr("data-translate"))),b[0].style[d.prefixStyle("transform")]="translate(0, "+f+"px)"+g+"scale("+i+")",a(b[1]).attr("data-translate")&&(c=h+parseInt(a(b[1]).attr("data-translate"))),b[1].style[d.prefixStyle("transform")]="translate(0, "+c+"px)"+g}},b.prototype.touchEnd=function(){if(e.moveStart&&(e.pageNext||0==e.pageNext)){e.moveStart=!1;var b=Math.abs(e.touchDeltaY);b>10&&(this.$page.eq(e.pageNow)[0].style[d.prefixStyle("transition")]="all .3s",this.$page.eq(e.pageNext)[0].style[d.prefixStyle("transition")]="all .3s"),b>=100?this.toggleSuccess():this.toggleFail(),e.movePosition=null,e.touchStartY=0,a(window).trigger("end",[e])}},b.prototype.toggleSuccess=function(){var b=this,c=d.translateZ();!e.returnFirst&&e.pageNext>=e.pageNumber-1&&a(".fixed-arrow").hide();var f=e.touchDeltaY>0?a(window).height():-a(window).height(),g=1;"scale"==e.switchEffect&&(g=.1,f/=5),this.$page.eq(e.pageNow)[0].style[d.prefixStyle("transform")]="translate(0, "+f+"px)"+c+"scale("+g+")",this.$page.eq(e.pageNext)[0].style[d.prefixStyle("transform")]="translate(0, 0)"+c,0==e.pageNext&&e.pageNow==e.pageNumber-1&&(e.returnLast=!0),setTimeout(function(){b.$page.eq(e.pageNow).addClass("fn-hide").removeClass("active").attr("data-translate","").css({transform:"",transition:""}),b.$page.eq(e.pageNext).addClass("active").attr("data-translate","").css({transform:"",transition:""}),e.touchDeltaY=0,e.moveStart=!0,e.pageNow=e.pageNext,e.pageNext=null},300),a(window).trigger("success",[e])},b.prototype.toggleFail=function(){var b=this,c=d.translateZ();this.$page.eq(e.pageNow)[0].style[d.prefixStyle("transform")]="translate(0, 0)"+c+"scale(1)";var f;f="up"==e.movePosition?a(window).height():-a(window).height(),this.$page.eq(e.pageNext)[0].style[d.prefixStyle("transform")]="translate(0, "+f+"px)"+c,setTimeout(function(){b.$page.eq(e.pageNow).addClass("active").attr("data-translate","").attr("style",""),b.$page.eq(e.pageNext).addClass("fn-hide").removeClass("active").attr("data-translate","").attr("style",""),e.touchDeltaY=0,e.moveStart=!0,e.pageNext=null},300),!e.returnFirst&&e.pageNow>=e.pageNumber-1&&a(".fixed-arrow").hide(),a(window).trigger("fail",[e])},b.prototype.lazyIMGStart=function(b){var c=a(".lazy-img"),d=c.length,e=0;d&&c.each(function(c){var f,g,h=a(this),i=h.attr("data-src");a("<img />").on("load",function(){h.is("img")?h.attr("src",i):(f=h.attr("data-position"),g=h.attr("data-size"),h.css({"background-image":"url("+i+")","background-position":f,"background-size":g})),e+=1,a(".loading-text").html(parseInt(e/d*100)+"%"),e>=d&&(b&&b(),a(".popup-loading").hide())}).attr("src",i)})},b.prototype.triggerFunction=function(){a(window).on("start",function(a,b){}),a(window).on("move",function(a,b){}),a(window).on("end",function(a,b){}),a(window).on("success",function(a,b){}),a(window).on("fail",function(a,b){})},window.Util=d,window.TouchPaging=b,{Util:d,TouchPaging:b}});