/** 
 * @Description: H5滑动翻页
 * @Author: wangjun 
 * @Update: 2015-10-14 18:04
 * @version: 2.0
 * @Github: https://github.com/nevergiveup-j/slide-page
 */
!function(a){"function"==typeof define&&define.amd?define(["Zepto"],a):a(Zepto)}(function(a){"use strict";function d(a){this.init(a)}navigator.userAgent;var c={elementStyle:document.createElement("div").style,vendor:function(){for(var b,a=["t","webkitT","MozT","msT","OT"],d=0,e=a.length;e>d;d++)if(b=a[d]+"ransform",b in c.elementStyle)return a[d].substr(0,a[d].length-1);return!1},prefixStyle:function(a){return c.vendor()===!1?!1:""===c.vendor()?a:c.vendor()+a.charAt(0).toUpperCase()+a.substr(1)},hasPerspective:function(){var a=c.prefixStyle("perspective")in c.elementStyle;return a&&"webkitPerspective"in c.elementStyle&&c.injectStyles("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),!!a},translateZ:function(){return c.hasPerspective?" translateZ(0)":""},injectStyles:function(a,b,c,d){var e,f,g,h,i=document.createElement("div"),j=document.body,k=j||document.createElement("body"),l="modernizr";if(parseInt(c,10))for(;c--;)g=document.createElement("div"),g.id=d?d[c]:l+(c+1),i.appendChild(g);return e=["&#173;",'<style id="s',l,'">',a,"</style>"].join(""),i.id=l,(j?i:k).innerHTML+=e,k.appendChild(i),j||(k.style.background="",k.style.overflow="hidden",h=docElement.style.overflow,docElement.style.overflow="hidden",docElement.appendChild(k)),f=b(i,a),j?i.parentNode.removeChild(i):(k.parentNode.removeChild(k),docElement.style.overflow=h),!!f},scrollStop:function(){a(window).on("touchmove.scroll",c.scrollControl),a(window).on("scroll.scroll",c.scrollControl)},scrollStart:function(){a(window).off("touchmove.scroll"),a(window).off("scroll.scroll")},scrollControl:function(a){a.preventDefault()}};return d.prototype.init=function(b){var e={pages:".m-page",switchEffect:"default",lastReturnFirst:!0,pageTotal:0,pageNow:0,pageNext:null,moveDirection:"",touchStartCallback:function(){},touchMoveCallback:function(){},touchEndCallback:function(){},successCallback:function(){},failCallback:function(){}};this.opts=a.extend(!0,{},e,b||{}),this.$pages=a(this.opts.pages),this.opts.pageTotal=this.$pages.length,this.opts.pageTotal&&(document.body.style.userSelect="none",document.body.style.mozUserSelect="none",document.body.style.webkitUserSelect="none",c.hasPerspective()?a(document.body).addClass("yes-3d"):a(document.body).addClass("no-3d"),this.viewHeight=a(window).height(),this.$pages.css({height:this.viewHeight}),0!=this.opts.pageNow&&(this.$pages.addClass("fn-hide"),this.$pages.eq(this.opts.pageNow).removeClass("fn-hide").addClass("page-active animations")),this.$pageNow=null,this.$pageNext=null,this.startY=0,this.currentY=0,this.isTouchMove=!1,this.moveDirectionInit=!1,this.isMouseDown=!1,this.isTouchStart=!1,this.addEvent())},d.prototype.addEvent=function(){var b=this;a(window).on("touchstart mousedown",function(a){b.touchStart(a)}),a(window).on("touchmove mousemove",function(a){b.touchMove(a)}),a(window).on("touchend mouseup",function(a){b.touchEnd(a)})},d.prototype.removeEvent=function(){a(window).off("touchstart mousedown"),a(window).off("touchmove mousemove"),a(window).off("touchend mouseup")},d.prototype.touchStart=function(a){var c=0;"touchstart"==a.type?c=window.event.touches[0].pageY:(c=a.pageY||a.y,this.isMouseDown=!0),this.startY=c,this.isTouchStart=!0,this.opts.touchStartCallback&&this.opts.touchStartCallback(a,this.opts)},d.prototype.touchMove=function(a){var b,c=this.opts;if(a.preventDefault(),this.isTouchStart){if("touchmove"==a.type)b=window.event.touches[0].pageY;else{if(!this.isMouseDown)return;b=a.pageY||a.y}this.currentY=b-this.startY,c.moveDirection=this.currentY>0?"down":"up",!c.lastReturnFirst&&0==c.pageNow&&"down"==c.moveDirection||!c.lastReturnFirst&&c.pageNow>=c.pageTotal-1&&"up"==c.moveDirection||(c.pageNext=this.currentY>0?0==c.pageNow?c.pageTotal-1:c.pageNow-1:this.opts.pageNow>=c.pageTotal-1?0:this.opts.pageNow+1,this.isTouchMove=!0,this.$pageNow=this.$pages.eq(c.pageNow),this.$pageNext=this.$pages.eq(c.pageNext),c.moveDirection!=this.moveDirectionInit&&(this.moveDirectionInit=c.moveDirection,this.setInitNext()),this.moveTranslate(),this.opts.touchMoveCallback&&this.opts.touchMoveCallback(a,this.opts))}},d.prototype.touchEnd=function(a){if(this.isMouseDown=!1,this.isTouchStart=!1,this.isTouchMove){var c="fail";Math.abs(this.currentY)>=100&&(c="success"),this.togglePage(c),this.startY=0,this.currentY=0,this.opts.touchEndCallback&&this.opts.touchEndCallback(a,this.opts)}},d.prototype.setInitNext=function(){var b=0;c.translateZ(),b="up"==this.opts.moveDirection?this.viewHeight+parseInt(a(window).scrollTop(),10):-Math.max(this.viewHeight,this.$pageNext.height()),this.$pages.removeClass("page-active"),this.$pageNow.attr("data-translate",0),this.$pageNext.removeClass("fn-hide").addClass("page-active").attr("data-translate",b)},d.prototype.moveTranslate=function(){var d,e,a=c.translateZ(),b=1;"scale"==this.opts.switchEffect&&(b=1-Math.abs(.2*this.currentY/this.viewHeight)),d=this.currentY+parseInt(this.$pageNow.attr("data-translate"),10),e=this.currentY+parseInt(this.$pageNext.attr("data-translate")),this.$pageNow[0].style[c.prefixStyle("transform")]="translate(0, "+d+"px)"+a+"scale("+b+")",this.$pageNext[0].style[c.prefixStyle("transform")]="translate(0, "+e+"px)"+a},d.prototype.togglePage=function(b){var h,i,d=this,e=c.translateZ(),f="success",g=1;b==f?(h=this.currentY>0?this.viewHeight:-this.viewHeight,i=0):(h=0,i="up"==this.opts.moveDirection?this.viewHeight:-this.viewHeight),this.$pageNow[0].style[c.prefixStyle("transition")]="all .3s",this.$pageNext[0].style[c.prefixStyle("transition")]="all .3s",this.$pageNow[0].style[c.prefixStyle("transform")]="translate(0, "+h+"px)"+e+"scale("+g+")",this.$pageNext[0].style[c.prefixStyle("transform")]="translate(0, "+i+"px)"+e,setTimeout(function(){d.$pages.addClass("fn-hide"),b==f?(d.$pageNow.removeClass("page-active").attr("data-translate",""),d.$pageNext.removeClass("fn-hide").attr("data-translate",""),d.opts.pageNow=d.opts.pageNext,!d.opts.lastReturnFirst&&d.opts.pageNow>=d.opts.pageTotal-1?a(".fixed-arrow").addClass("fn-hide"):a(".fixed-arrow").removeClass("fn-hide"),d.opts.successCallback&&d.opts.successCallback(d.opts)):(d.$pageNow.removeClass("fn-hide").attr("data-translate",""),d.$pageNext.removeClass("page-active").attr("data-translate",""),d.opts.failCallback&&d.opts.failCallback(d.opts)),d.$pageNow[0].style[c.prefixStyle("transition")]="",d.$pageNow[0].style[c.prefixStyle("transform")]="",d.$pageNext[0].style[c.prefixStyle("transition")]="",d.$pageNext[0].style[c.prefixStyle("transform")]="",d.isTouchMove=!1,d.moveDirectionInit=!1,d.opts.pageNext=null},300)},window.Util=c,window.TouchPaging=d,{Util:c,TouchPaging:d}});