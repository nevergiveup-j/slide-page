/** 
 * @Description: h5slide-page 
 * @Author: wangjun 
 * @Update: 2015-10-29 15:10 
 * @Github: https://github.com/nevergiveup-j/slide-page 
 */ 
!function(a){"function"==typeof define&&define.amd?define(["Zepto"],a):a(Zepto)}(function(a){"use strict";function b(a){this.init(a)}var c=(navigator.userAgent,{elementStyle:document.createElement("div").style,vendor:function(){for(var a,b=["t","webkitT","MozT","msT","OT"],d=0,e=b.length;e>d;d++)if(a=b[d]+"ransform",a in c.elementStyle)return b[d].substr(0,b[d].length-1);return!1},prefixStyle:function(a){return c.vendor()===!1?!1:""===c.vendor()?a:c.vendor()+a.charAt(0).toUpperCase()+a.substr(1)},hasPerspective:function(){var a=c.prefixStyle("perspective")in c.elementStyle;return a&&"webkitPerspective"in c.elementStyle&&c.injectStyles("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),!!a},translateZ:function(){return c.hasPerspective?" translateZ(0)":""},injectStyles:function(a,b,c,d){var e,f,g,h,i=document.createElement("div"),j=document.body,k=j||document.createElement("body"),l="modernizr";if(parseInt(c,10))for(;c--;)g=document.createElement("div"),g.id=d?d[c]:l+(c+1),i.appendChild(g);return e=["&#173;",'<style id="s',l,'">',a,"</style>"].join(""),i.id=l,(j?i:k).innerHTML+=e,k.appendChild(i),j||(k.style.background="",k.style.overflow="hidden",h=docElement.style.overflow,docElement.style.overflow="hidden",docElement.appendChild(k)),f=b(i,a),j?i.parentNode.removeChild(i):(k.parentNode.removeChild(k),docElement.style.overflow=h),!!f},scrollStop:function(){a(window).on("touchmove.scroll",c.scrollControl),a(window).on("scroll.scroll",c.scrollControl)},scrollStart:function(){a(window).off("touchmove.scroll"),a(window).off("scroll.scroll")},scrollControl:function(a){a.preventDefault()}});return b.prototype.init=function(b){var d={pages:".m-page",loadIMG:"img",loadImgData:[],switchEffect:"default",lastReturnFirst:!0,pageTotal:0,pageNow:0,pageNext:null,moveDirection:"",touchStartCallback:function(){},touchMoveCallback:function(){},touchEndCallback:function(){},successCallback:function(){},failCallback:function(){}};this.opts=a.extend(!0,{},d,b||{}),this.$pages=a(this.opts.pages),this.opts.pageTotal=this.$pages.length,this.opts.pageTotal&&(document.body.style.userSelect="none",document.body.style.mozUserSelect="none",document.body.style.webkitUserSelect="none",a(document.body).addClass(c.hasPerspective()?"yes-3d":"no-3d"),this.viewHeight=a(window).height(),this.$pages.css({height:this.viewHeight}),0!=this.opts.pageNow&&(this.$pages.addClass("fn-hide"),this.$pages.eq(this.opts.pageNow).removeClass("fn-hide").addClass("page-active animations")),this.$pageNow=null,this.$pageNext=null,this.startY=0,this.currentY=0,this.isTouchMove=!1,this.moveDirectionInit=!1,this.isMouseDown=!1,this.isTouchStart=!1,this.isClickButton=!1,this.loadIMGStart(),this.addEvent())},b.prototype.loadIMGStart=function(b){function c(){h+=1,a(".loading-text").html(Math.floor(h/g*100)+"%"),h>=g&&(b&&b(),a(".popup-loading").hide())}var d,e=a("img"),f=this.opts.loadImgData,g=0,h=0;e.length&&e.each(function(){d=a(this).attr("src"),f.push(d)}),g=f.length;for(var i=0;g>i;i++)d=f[i],a("<img />").on("load",function(){c()}).error(function(){c()}).attr("src",d)},b.prototype.addEvent=function(){var b=this;a(window).on("touchstart mousedown",function(a){b.touchStart(a)}),a(window).on("touchmove mousemove",function(a){b.touchMove(a)}),a(window).on("touchend mouseup",function(a){b.touchEnd(a)})},b.prototype.removeEvent=function(){a(window).off("touchstart mousedown"),a(window).off("touchmove mousemove"),a(window).off("touchend mouseup")},b.prototype.touchStart=function(a){var b=0;"touchstart"==a.type?b=window.event.touches[0].pageY:(b=a.pageY||a.y,this.isMouseDown=!0),this.startY=b,this.isTouchStart=!0,this.opts.touchStartCallback&&this.opts.touchStartCallback(a,this.opts)},b.prototype.touchMove=function(a){var b,c=this.opts;if(a.preventDefault(),this.isTouchStart){if("touchmove"==a.type)b=window.event.touches[0].pageY;else{if(!this.isMouseDown)return;b=a.pageY||a.y}this.currentY=b-this.startY,c.moveDirection=this.currentY>0?"down":"up",!c.lastReturnFirst&&0==c.pageNow&&"down"==c.moveDirection||!c.lastReturnFirst&&c.pageNow>=c.pageTotal-1&&"up"==c.moveDirection||(c.pageNext=this.currentY>0?0==c.pageNow?c.pageTotal-1:c.pageNow-1:this.opts.pageNow>=c.pageTotal-1?0:this.opts.pageNow+1,this.isTouchMove=!0,this.$pageNow=this.$pages.eq(c.pageNow),this.$pageNext=this.$pages.eq(c.pageNext),c.moveDirection!=this.moveDirectionInit&&(this.moveDirectionInit=c.moveDirection,this.setInitNext()),this.moveTranslate(),this.opts.touchMoveCallback&&this.opts.touchMoveCallback(a,this.opts))}},b.prototype.touchEnd=function(a){if(this.isMouseDown=!1,this.isTouchStart=!1,this.isTouchMove){var b="fail";Math.abs(this.currentY)>=100&&(b="success"),this.togglePage(b),this.startY=0,this.currentY=0,this.opts.touchEndCallback&&this.opts.touchEndCallback(a,this.opts)}},b.prototype.setInitNext=function(){var b=0,d=c.translateZ();b="up"==this.opts.moveDirection?this.viewHeight+parseInt(a(window).scrollTop(),10):-Math.max(this.viewHeight,this.$pageNext.height()),this.$pages.removeClass("page-active"),this.$pageNow.attr("data-translate",0),this.$pageNext.removeClass("fn-hide").addClass("page-active").attr("data-translate",b),this.$pageNext[0].style[c.prefixStyle("transform")]="translate(0, "+b+"px)"+d},b.prototype.moveTranslate=function(){var a=c.translateZ(),b=1;"scale"==this.opts.switchEffect&&(b=1-Math.abs(.2*this.currentY/this.viewHeight));var d=this.currentY+parseInt(this.$pageNow.attr("data-translate"),10),e=this.currentY+parseInt(this.$pageNext.attr("data-translate"));this.$pageNow[0].style[c.prefixStyle("transform")]="translate(0, "+d+"px)"+a+"scale("+b+")",this.$pageNext[0].style[c.prefixStyle("transform")]="translate(0, "+e+"px)"+a},b.prototype.togglePage=function(b){var d,e,f=this,g=c.translateZ(),h="success",i=1;b==h?(d=this.currentY>0?this.viewHeight:-this.viewHeight,e=0):(d=0,e="up"==this.opts.moveDirection?this.viewHeight:-this.viewHeight),this.$pageNow=this.$pages.eq(this.opts.pageNow),this.$pageNext=this.$pages.eq(this.opts.pageNext),this.$pageNow[0].style[c.prefixStyle("transition")]="all .3s",this.$pageNext[0].style[c.prefixStyle("transition")]="all .3s",this.$pageNow[0].style[c.prefixStyle("transform")]="translate(0, "+d+"px)"+g+"scale("+i+")",this.$pageNext[0].style[c.prefixStyle("transform")]="translate(0, "+e+"px)"+g,setTimeout(function(){f.$pages.addClass("fn-hide"),b==h?(f.$pageNow.removeClass("page-active").attr("data-translate",""),f.$pageNext.removeClass("fn-hide").attr("data-translate",""),f.opts.pageNow=f.opts.pageNext,!f.opts.lastReturnFirst&&f.opts.pageNow>=f.opts.pageTotal-1?a(".fixed-arrow").addClass("fn-hide"):a(".fixed-arrow").removeClass("fn-hide"),f.opts.successCallback&&f.opts.successCallback(f.opts)):(f.$pageNow.removeClass("fn-hide").attr("data-translate",""),f.$pageNext.removeClass("page-active").attr("data-translate",""),f.opts.failCallback&&f.opts.failCallback(f.opts)),f.$pageNow[0].style[c.prefixStyle("transition")]="",f.$pageNow[0].style[c.prefixStyle("transform")]="",f.$pageNext[0].style[c.prefixStyle("transition")]="",f.$pageNext[0].style[c.prefixStyle("transform")]="",f.isTouchMove=!1,f.isClickButton=!1,f.moveDirectionInit=!1,f.opts.pageNext=null},300)},b.prototype.prevPage=function(){var a=this,b=0==this.opts.pageNow;this.isClickButton||!this.opts.lastReturnFirst&&b||(this.opts.moveDirection="down",this.isClickButton=!0,this.currentY=100,this.opts.pageNext=b?this.opts.pageTotal-1:this.opts.pageNow-1,this.$pageNow=this.$pages.eq(this.opts.pageNow),this.$pageNext=this.$pages.eq(this.opts.pageNext),this.setInitNext(),setTimeout(function(){a.togglePage("success"),a.currentY=0},100))},b.prototype.nextPage=function(){var a=this,b=this.opts.pageNow>=this.opts.pageTotal-1;this.isClickButton||!this.opts.lastReturnFirst&&b||(this.opts.moveDirection="up",this.isClickButton=!0,this.opts.pageNext=b?0:this.opts.pageNow+1,this.$pageNow=this.$pages.eq(this.opts.pageNow),this.$pageNext=this.$pages.eq(this.opts.pageNext),this.setInitNext(),setTimeout(function(){a.togglePage("success")},100))},window.Util=c,window.SlidePage=b,{Util:c,SlidePage:b}});